version: '3.8'

services:
  firebase-emulators:
    image: node:18-alpine
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
      resources:
        limits:
          memory: 512M
    ports:
      - target: 4000
        published: 4000
        protocol: tcp
      - target: 8080
        published: 8080
        protocol: tcp
      - target: 9099
        published: 9099
        protocol: tcp
      - target: 9199
        published: 9199
        protocol: tcp
      - target: 5001
        published: 5001
        protocol: tcp
    volumes:
      - emulator-data:/root/.cache/firebase/emulators
    command: >
      sh -c "npm install -g firebase-tools &&
             firebase emulators:start --project=kua-dev --import=./seed-data"
    
  flutter-web:
    image: nginx:alpine
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - target: 80
        published: 8080
        protocol: tcp
    volumes:
      - ./frontend/build/web:/usr/share/nginx/html:ro

volumes:
  emulator-data:
    driver: local